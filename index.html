<!DOCTYPE html>
<html>
<head>
  <title>Leaflet Car Speed Simulation â€“ Single School, Custom Route</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { height: 100vh; width: 100vw; }
    #info {
      position: absolute;
      top: 10px; left: 10px;
      z-index: 1000;
      background: #fff;
      padding: 12px 16px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.25);
      font-family: Arial, sans-serif;
      font-size: 15px;
      max-width: 285px;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="info"><b>Loading map and route...</b></div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Center map between start and end
    var map = L.map('map').setView([19.063, 72.846], 16);

    // Add OpenStreetMap base
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    var infoDiv = document.getElementById('info');

    // Mark your one school location, and use for school zone logic
    var schoolLatLng = [19.063607719563397, 72.8462002686538];
    L.circleMarker(schoolLatLng, {
      radius: 10,
      color: 'red',
      fillColor: '#f88',
      fillOpacity: 0.98
    }).addTo(map).bindPopup('School');
    var schoolPoint = L.latLng(schoolLatLng[0], schoolLatLng[1]);

    // Draw the route you specified; add more points if you want more detailed path!
    var routeCoords = [
      [19.06098409033655, 72.84450074043295],  // Start
      [19.0619, 72.8448],
      [19.0629, 72.8451],
      [19.063607719563397, 72.8462002686538],  // Point at/near school
      [19.0645, 72.8463],
      [19.0657, 72.8463],
      [19.066607637929415, 72.84632342144964]  // End
    ];
    L.polyline(routeCoords, { color: 'blue', weight: 4 }).addTo(map);

    // Start the car animation
    startCarAnimation(routeCoords);

    function startCarAnimation(route) {
      var carIcon = L.icon({
        iconUrl: 'https://cdn-icons-png.flaticon.com/512/1783/1783337.png',
        iconSize: [32, 32], iconAnchor: [16, 16],
      });
      var car = L.marker(route[0], { icon: carIcon }).addTo(map);

      var idx = 0;
      var SPEED_NORMAL = 100; // km/h
      var SPEED_SCHOOL = 20;  // km/h
      var stepDistM = 3; // meters per animation step
      var currentSpeed = SPEED_NORMAL;

      function animateStep() {
        if (idx >= route.length - 1) {
          infoDiv.innerHTML += '<br><b>Route completed.</b>';
          return;
        }
        var pos = car.getLatLng();
        var next = L.latLng(route[idx+1]);
        var segDist = pos.distanceTo(next);
        var frac = Math.min(stepDistM / segDist, 1);

        var lat = pos.lat + (next.lat - pos.lat) * frac;
        var lng = pos.lng + (next.lng - pos.lng) * frac;
        var newPos = L.latLng(lat, lng);

        // School zone logic
        var distToSchool = newPos.distanceTo(schoolPoint);
        var inSchoolZone = distToSchool < 100;
        currentSpeed = inSchoolZone ? SPEED_SCHOOL : SPEED_NORMAL;

        infoDiv.innerHTML =
          `<b>Position:</b> ${lat.toFixed(6)}, ${lng.toFixed(6)}<br>` +
          `<b>Speed Limit:</b> ${currentSpeed} km/h<br>` +
          `<b>Status:</b> ${inSchoolZone ? '<span style="color:red">In School Zone</span>' : 'Normal Area'}<br>` +
          `<b>Distance to school:</b> ${Math.round(distToSchool)} m`;

        car.setLatLng(newPos);
        map.panTo(newPos);

        if (frac === 1) idx++;
        setTimeout(animateStep, inSchoolZone ? 300 : 75);
      }
      animateStep();
    }
  </script>
</body>
</html>
